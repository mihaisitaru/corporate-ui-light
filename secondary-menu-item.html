<link rel="import" href="../polymer-1.4.0/polymer.html">
<link rel="import" href="behaviors/menu-behavior.html">
<link rel="import" href="behaviors/global-behavior.html">

<dom-module id="secondary-menu-item">
  <template>
    <style>
         :host .dropdown.open .caret {
             transform: rotate(180deg);
         }
         :host .navbar-nav .dropdown-menu > li {
             display: block;
         }
         :host .navbar-nav .dropdown-menu li a {
             padding: 7px 2px;
             text-transform: capitalize;
             color: #555;
         }
         :host .navbar-nav .dropdown a {
             cursor: pointer;
         }
         :host .navbar-nav .dropdown-menu li a:before {
             padding-right: 0;
             padding-left: 0;
         }
         /*:host .navbar-nav .dropdown-menu li a:focus, :host .navbar-nav .dropdown-menu li a:hover {*/
             /*color: #041e42;*/
         /*}*/
         :host .navbar-nav .dropdown-menu li a:focus,
         :host .navbar-nav .dropdown-menu li a:hover,
         :host .navbar-nav .dropdown-menu li a:visited,
         :host .navbar-nav .dropdown-menu li.active a {
             /*border-bottom: 2px solid #d6001c;*/
             color: #041e42;
         }

    </style>

    <ul class="nav navbar-nav navbar-right">
          <template is="dom-if" if="{{dropdownMenu}}">
              <template is="dom-repeat" items="{{items}}" as="parent">
              <li class="dropdown">
              <a class="dropdown-toggle dropdown-trigger" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                  {{parent.title}}
                  <span class="caret"></span>
              </a>

                <ul class="dropdown-menu secondary-dropdown">
               <template is="dom-repeat" items="{{parent.items}}">
                 <li class$="{{conditionalClass('active', item, 'active')}}">
                    <a href="{{item.href}}" target="{{conditionalAttr(item.target)}}" on-click="onDropdownItemActive">
                        {{item.title}}
                    </a>
                </li>
              </template>
              </ul>
            </li>
          </template>
          </template>
          <template is="dom-if" if="{{!dropdownMenu}}">
               <template is="dom-repeat" items="{{items}}">
                 <li class$="{{conditionalClass('active', item, 'active')}}">
                    <a href="{{item.href}}" target="{{conditionalAttr(item.target)}}">
                        {{item.title}}
                    </a>
                </li>
              </template>
          </template>
        <li id="customContent">
          <content></content>
        </li>
      </ul>
  </template>

  <script>
  Polymer({
      is: 'secondary-menu-item',
      behaviors: [CUIBehaviors.MenuBehavior, CUIBehaviors.GlobalBehavior],

      properties: {
          dropdown: {
              type: String,
              value: '',
              observer: '_dropdown'
          }
      },
      created: function () {
          var textTemplate= document.querySelector('secondary-menu-item:not([dropdown]) li#customContent');
          if(textTemplate && textTemplate.innerHTML.trim() !== ''){
              var customContent = $(textTemplate.innerHTML).clone();
              document.dispatchEvent(new CustomEvent('custom-content-added', {detail: {customContent: customContent, bubbles: false, composed: true}}));
          }
      },
      attributeChanged: function (name, type) {
          console.log('Secondary hideMenu', this.hideMenu);
          Polymer.RenderStatus.afterNextRender(this, function () {
              var secondaryDropdownActiveItems = this.querySelector('.secondary-menu-item.secondary-dropdown li.active');
              if(secondaryDropdownActiveItems){
                  this._setDropdownToActive();
              }
          }.bind(this));
      },
      _dropdown: function () {
          this.dropdownMenu = (this.dropdown === 'true');
      },
      onDropdownItemActive: function(event){
          this.toggle(event.target.parentNode);
          this._setDropdownToActive();
      },
      _setDropdownToActive: function(){
          this.querySelector('.dropdown-toggle').parentNode.classList.add('active');
      }
  });
  </script>

</dom-module>

