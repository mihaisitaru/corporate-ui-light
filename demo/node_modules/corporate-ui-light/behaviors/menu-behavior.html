<link rel="import" href="../../polymer-1.4.0/polymer.html">

  <script>
    window.CUIBehaviors = window.CUIBehaviors || {};

    CUIBehaviors.MenuBehavior = {
      properties: {
        items: {
          type: Array,
          value: function () {
            return [];
          },
          observer: '_itemAdded'
        }
      },
      identification: {},

      setActiveMenu: function (selector) {
        var activeItem = this.querySelector(selector);
        if(activeItem){
          this.getActiveSubmenu(activeItem.title, activeItem.id).classList.add('open');
        }
      },
      subMenuHash: function(title) {
        var matcher = /[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g;
        if(title) {
          return title.match(matcher).join('-').toLowerCase();
        }
      },
      resetMenu: function(subMenuSelector, activeItemsSelector){
        var allOpenSubMenu = this.querySelectorAll(subMenuSelector),
                allActiveItems = this.querySelectorAll(activeItemsSelector);

        allOpenSubMenu.forEach(function (element) {
          element.classList.remove('open');
        });
        allActiveItems.forEach(function (element) {
          element.classList.remove('active');
        });
      },
      getActiveSubmenu: function(title, id){
        var subMenuHash = this.subMenuHash(title) + '-' + id,
                activeSubMenu = this.querySelector('#' + subMenuHash);
        return activeSubMenu;
      },

      _itemAdded: function () {
        document.dispatchEvent(new CustomEvent('menu-items-added', {detail: {menuItems: this.items, bubbles: false, composed: true}}));
      },

      registered: function() {
        this.behaviors.map(function(behavior) {
          console.log('behavior', behavior.identification);
        });
      }
    };

  </script>

