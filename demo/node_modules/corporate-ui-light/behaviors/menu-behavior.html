<link rel="import" href="../../polymer-1.4.0/polymer.html">

  <script>
    window.CUIBehaviors = window.CUIBehaviors || {};

    CUIBehaviors.MenuBehavior = {
      properties: {
        items: {
          type: Array,
          value: function () {
            return [];
          },
          observer: '_itemAdded'
        }
      },
      identifier: 'MenuBehavior',
      secondaryCustomContent:[],
      identification: [],
      allMenuItems: [],

      subMenuHash: function(title) {
        var matcher = /[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g;
        if(title) {
          return title.match(matcher).join('-').toLowerCase();
        }
      },
      resetMenu: function(subMenuSelector){
        var allOpenSubMenu = document.querySelectorAll(subMenuSelector);

        allOpenSubMenu.forEach(function (element) {
          element.classList.remove('open');
        });
      },
      toggleSubmenu: function (parentNode, activeSubmenu, notify) {
          if(notify){
              document.body.removeAttribute('ks-primary-submenu-open');
          }
          if(activeSubmenu) {
              activeSubmenu.classList.add('open');
              if(notify){
                  document.body.setAttribute('ks-primary-submenu-open', '');
              }
          }
      },
      getActiveSubmenu: function(title, id){
        var subMenuHash = this.subMenuHash(title) + '-' + id,
                activeSubMenu = this.querySelector('#' + subMenuHash);
        return activeSubMenu;
      },
      _itemAdded: function () {
          if(this.items && this.items.length > 0){
              CUIBehaviors.GlobalBehavior.mergeArray(this.items, this.allMenuItems);
          }
      },
        _initMenu: function(selector){
            var activeItem = this.querySelector(selector);
            if (activeItem) {
                this.toggle(activeItem.parentNode);
            }
        },
        toggle: function (parentNode, isPrimary) {
            if(isPrimary){
                document.querySelectorAll('.dropdown-trigger').forEach(function(trigger){
                    trigger.parentNode.classList.remove('active');
                })
            }else{
                CUIBehaviors.GlobalBehavior.safeCall(document.querySelector('.more-trigger').parentNode.classList, 'remove', 'active')
            }
            var activeSubmenu = this.getActiveSubmenu(parentNode.title, parentNode.id);
            this.resetMenu('.subnav.open');
            this.toggleSubmenu(parentNode, activeSubmenu, true);
        },
      registered: function() {
        var registeredElement = [];
        registeredElement = this.behaviors.map(function(behavior) {
          if(behavior.identifier == 'MenuBehavior'){
            return behavior.identification;
          }
        });
        if(registeredElement.length > 0){
//          this.registeredMenuComponents = registeredElement;
        }
      }
    };

  </script>

