<link rel="import" href="../polymer-1.4.0/polymer.html">
<link rel="stylesheet" href="https://static.scania.com/resources/icons/font-awesome/5.3.1/css/all.min.css">
<link rel="stylesheet" href="https://d31jnweo1ynb8u.cloudfront.net/vendors/frameworks/bootstrap/3.2.0/dist/css/bootstrap-org.css">
<link rel="stylesheet" href="https://d31jnweo1ynb8u.cloudfront.net/build/global/3.5.0/css/corporate-ui.css">
<link rel="stylesheet" href="../bootstrap-treeview/dist/bootstrap-treeview.min.css">

<dom-module id="ks-device-menu">
<style>
    :host .node-ksDeviceMenu {
        font-family: "Scania Sans";
        background-color: #f5f5f5;
        padding: 10px 5px;
        font-size: 14px;
        font-weight: 400;
        text-transform: capitalize;
    }
    :host .node-ksDeviceMenu.top-level {
        width: 80%;
        font-size: 14px;
        font-weight: 700;
        overflow: hidden;
        word-break: normal;
        white-space: nowrap;
        text-transform: uppercase;
        text-overflow: ellipsis;
    }
    :host .node-ksDeviceMenu.top-level a {
        font-size: 14px;
        font-weight: 700;
        text-transform: uppercase;
    }
    :host .node-ksDeviceMenu a {
        font-size: 14px;
        font-weight: 400;
        text-transform: capitalize;
    }
    :host #ksDeviceMenu .list-group {
        padding-left: 15px;
        padding-right: 15px;
        margin-bottom: 10px;
        margin-top: 27px;
    }
    :host .node-ksDeviceMenu.node-selected {
        font-family: "Scania Sans ";
        color: #4a8ba4;
        background-color: transparent;
        border-left: 4px solid #4a8ba4;
    }
    :host .node-ksDeviceMenu.node-expanded {
        font-family: "Scania Sans";
        font-weight: bold;
        color: #041e42;
    }
</style>
  <template>
    <div class="visible-xs visible-sm" id="ksDeviceMenu"></div>
  </template>
    <script src="../bootstrap-treeview/src/js/bootstrap-treeview.js"></script>
  <script>

  Polymer({
      is: 'ks-device-menu',
      behaviors: [CUIBehaviors.GlobalBehavior, CUIBehaviors.MenuBehavior],

      ready: function () {
          document.addEventListener('custom-content-added', this._buildMenu.bind(this));
          document.addEventListener('click', this._onClick.bind(this));

          this.scopeSubtree(this.$.ksDeviceMenu, true);
      },
      _onClick: function (event) {
          var clickOver = event.target,
              parentNode = this.parentNode.classList,
              isOpened = parentNode.contains('navbar-collapse') && parentNode.contains('in'),
              isToggleButton = clickOver.classList.contains('navbar-toggle'),
              isMenuItem = this.findById(event.path, 'ksDeviceMenu');

          if (isOpened && !isToggleButton && !isMenuItem) {
              this._toggleCollapse();
          }
      },
      _toggleCollapse: function () {
          document.querySelector('button.navbar-toggle').classList.add('collapsed');
          this.parentNode.classList.remove('in');
      },
      _buildMenu: function (event) {
          var options = {
              showBorder: false,
              color: '#909090',
              hoverTextColor: '#041e42',
              collapseIcon: 'none',
              expandIcon: 'none',
              emptyIcon: 'none',
              enableLinks: true,
              customSelectedStyle: 'custom',
              customExpandedStyle: 'custom',
              indentNode: true,
              data: this._formatedNodes(),
              decorator: this._decorate.bind(this),
              onNodeSelected: this._toggleCollapse.bind(this),
              customTemplate: event.detail.customContent
          };

          $('#ksDeviceMenu').treeview(options);
          $('#ksDeviceMenu').treeview('collapseAll', {silent: true});
      },
      _formatedNodes: function () {
          return this.allMenuItems.map(function(node){
              node = this.renamePropertiy(node, 'items', 'nodes');
              node = this.renamePropertiy(node, 'title', 'text');
              node.selector = 'top-level';
              return node;

          }, this);
      },
      _decorate: function (node) {
          node.selectable = node.nodes === undefined;
          return node;
      }
  });
  </script>
</dom-module>